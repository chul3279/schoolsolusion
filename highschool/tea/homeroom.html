<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google Analytics (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LJ1TCE277"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7LJ1TCE277');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SchoolUs - 담임 업무</title>
    <script src="/static/js/tailwindcss.js"></script>
    <link href="/static/fontawesome/css/all.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
body { font-family: 'Noto Sans KR', sans-serif; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .sidebar-gradient { background: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #334155 100%); }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.8); }
        
        .nav-item { position: relative; transition: all 0.3s ease; }
        .nav-item::before { content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 0; background: linear-gradient(90deg, rgba(59, 130, 246, 0.3), transparent); transition: width 0.3s ease; }
        .nav-item:hover::before { width: 100%; }
        .nav-item.active { background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), transparent); border-left: 3px solid #3b82f6; }
        
        .avatar-ring { background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899); padding: 3px; }
        
        .tab-btn { transition: all 0.2s; }
        .tab-btn.active { background: linear-gradient(135deg, #10b981, #059669); color: white; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }

        #mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 40; }
        #mobile-overlay.active { display: block; }
        #sidebar.mobile-open { display: flex !important; position: fixed !important; left: 0 !important; top: 0 !important; bottom: 0 !important; z-index: 50 !important; flex-direction: column !important; }

        /* 모바일 큰 글씨 대응: 터치 영역 확대 + 사이드바 전체 스크롤 */
        @media (max-width: 767px) {
            #sidebar.mobile-open { overflow-y: auto !important; }
            #sidebar.mobile-open .nav-wrap { flex: none !important; min-height: auto !important; }
            #sidebar.mobile-open #sidebar-nav { height: auto !important; overflow: visible !important; }
            .nav-item { min-height: 52px; padding-top: 14px !important; padding-bottom: 14px !important; font-size: 15px !important; }
            #sidebar .space-y-1 > li { margin-bottom: 4px; }
            #sidebar .p-4.border-t a { min-height: 48px; padding-top: 14px !important; padding-bottom: 14px !important; font-size: 14px !important; }
            .tab-btn { min-height: 48px; padding: 12px 16px !important; font-size: 14px !important; white-space: nowrap; }
        }

        /* 출력 스타일 */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area {
                position: absolute; left: 0; top: 0; width: 100%;
                background: white; padding: 20px;
            }
            #print-area table { width: 100%; border-collapse: collapse; }
            #print-area th, #print-area td {
                border: 1px solid #333; padding: 8px 12px; text-align: left; font-size: 12px;
            }
            #print-area th { background: #f0f0f0; font-weight: bold; }
            #print-area .print-header { text-align: center; margin-bottom: 20px; }
            #print-area .print-header h2 { font-size: 18px; font-weight: bold; margin-bottom: 4px; }
            #print-area .print-header p { font-size: 13px; color: #555; }
            .no-print { display: none !important; }
        }
    </style>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SchoolUs">
    <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">
    <script src="/static/js/pwa-install.js" defer></script>
    <script src="/static/js/pwa-push.js" defer></script>
</head>
<body class="bg-gradient-to-br from-slate-100 via-slate-50 to-green-50 text-slate-800">

    <div class="flex h-screen overflow-hidden">
        <!-- 사이드바 -->
        <div id="mobile-overlay"></div>
        <aside id="sidebar" class="w-72 sidebar-gradient text-slate-300 hidden md:flex flex-col flex-shrink-0 shadow-2xl">
            <div class="p-6 border-b border-slate-700/50">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
                        <i class="fas fa-school text-xl"></i>
                    </div>
                    <div>
                        <span class="font-black text-2xl text-white tracking-tight">SchoolUs</span>
                        <p class="text-xs text-slate-400 font-medium">스마트 교육 플랫폼</p>
                    </div>
                </div>
            </div>
            
            <div class="p-5 border-b border-slate-700/50 bg-slate-800/30">
                <div class="flex items-center gap-4">
                    <div class="avatar-ring rounded-full">
                        <div class="w-14 h-14 rounded-full bg-slate-800 flex items-center justify-center text-white font-black text-xl" id="teacher-avatar">T</div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white font-bold text-lg truncate" id="teacher-name">-</p>
                        <p class="text-xs text-slate-400 truncate" id="teacher-info">-</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto py-4">
                <ul class="space-y-1 px-3 mb-4">
                    <li>
                        <a href="../tea.html" class="nav-item flex items-center px-4 py-3 rounded-xl hover:text-white font-medium">
                            <i class="fas fa-desktop w-6 mr-3 text-blue-400"></i> 대시보드
                        </a>
                    </li>
                </ul>
                <ul class="space-y-1 px-3">
                    <li>
                        <a href="homeroom.html" class="nav-item active flex items-center px-4 py-3 rounded-xl text-white font-medium">
                            <i class="fas fa-chalkboard-user w-6 mr-3 text-green-400"></i> 담임업무
                        </a>
                    </li>
                    <li>
                        <a href="subject.html" class="nav-item flex items-center px-4 py-3 rounded-xl hover:text-white font-medium">
                            <i class="fas fa-book-open w-6 mr-3 text-purple-400"></i> 교과업무
                        </a>
                    </li>
                    <li>
                        <a href="/highschool/admission/admission.html" class="nav-item flex items-center px-4 py-3 rounded-xl hover:text-white font-medium">
                            <i class="fas fa-graduation-cap w-6 mr-3 text-pink-400"></i> 입시상담
                        </a>
                    </li>
                    <li>
                        <a href="schooladmin.html" class="nav-item flex items-center px-4 py-3 rounded-xl hover:text-white font-medium">
                            <i class="fas fa-cog w-6 mr-3 text-yellow-400"></i> 행정업무
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="p-4 border-t border-slate-700/50 space-y-2">
                <a href="../mypage.html" class="flex items-center justify-center w-full py-3 bg-slate-800/50 hover:bg-blue-500/20 hover:text-blue-400 rounded-xl text-sm font-medium transition-all">
                    <i class="fas fa-user-cog mr-2"></i> 회원정보 수정
                </a>
                <a href="#" onclick="handleLogout()" class="flex items-center justify-center w-full py-3 bg-slate-800/50 hover:bg-red-500/20 hover:text-red-400 rounded-xl text-sm font-medium transition-all">
                    <i class="fas fa-sign-out-alt mr-2"></i> 로그아웃
                </a>
            </div>
        </aside>

        <!-- 메인 컨텐츠 -->
        <div class="flex-1 flex flex-col h-screen overflow-hidden">
            <header class="bg-white/80 backdrop-blur-lg h-16 border-b border-slate-200/50 flex items-center justify-between px-6 shadow-sm z-10">
                <div class="flex items-center gap-4">
                    <button id="sidebar-toggle" onclick="toggleMobileSidebar()" class="md:hidden text-slate-600"><i class="fas fa-bars text-xl"></i></button>
                    <div class="flex items-center text-slate-500">
                        <span class="text-sm font-medium">나의 대시보드</span>
                        <i class="fas fa-chevron-right mx-2 text-xs text-slate-300"></i>
                        <span class="text-sm font-bold text-green-600">담임업무</span>
                    </div>
                    <span id="class-badge" class="hidden bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold"></span>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-6">
                <!-- 담임 아님 표시 -->
                <div id="no-homeroom-view" class="hidden">
                    <div class="glass-card rounded-2xl shadow-lg p-12 text-center">
                        <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mb-6 mx-auto">
                            <i class="fas fa-user-slash text-4xl text-slate-400"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 mb-2">담임 학급이 배정되지 않았습니다</h3>
                        <p class="text-slate-500">담임 학급 배정 후 이용 가능합니다.</p>
                    </div>
                </div>

                <!-- 담임 메인 뷰 -->
                <div id="homeroom-view" class="hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-black text-slate-800">학급 관리</h1>
                        <p class="text-slate-500 text-sm mt-1">우리 반 학생들의 정보, 상담, 생활기록부를 관리합니다.</p>
                    </div>

                    <!-- 탭 버튼 -->
                    <div class="flex gap-2 mb-6 flex-wrap">
                        <button onclick="switchTab('students')" class="tab-btn active px-5 py-2.5 rounded-xl font-bold text-sm" id="tab-students">
                            <i class="fas fa-users mr-2"></i>학생 명단
                        </button>
                        <button onclick="switchTab('parents')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-parents">
                            <i class="fas fa-user-friends mr-2"></i>학부모 명단
                        </button>
                        <button onclick="switchTab('notice')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-notice">
                            <i class="fas fa-bullhorn mr-2"></i>학급 공지
                        </button>
                        <button onclick="switchTab('schedule')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-schedule">
                            <i class="fas fa-calendar-check mr-2"></i>상담 일정
                        </button>
                        <button onclick="switchTab('log')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-log">
                            <i class="fas fa-clipboard-list mr-2"></i>상담 일지
                        </button>
                        <button onclick="switchTab('record')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-record">
                            <i class="fas fa-database mr-2"></i>생기부 기초자료
                        </button>
                        <button onclick="switchTab('maker')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-maker">
                            <i class="fas fa-file-signature mr-2"></i>생기부 작성
                        </button>
                        <button onclick="switchTab('attendance')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-attendance">
                            <i class="fas fa-clipboard-check mr-2"></i>출결 관리
                        </button>
                        <button onclick="switchTab('vote')" class="tab-btn px-5 py-2.5 rounded-xl font-bold text-sm bg-white border-2 border-slate-200" id="tab-vote">
                            <i class="fas fa-vote-yea mr-2"></i>학급 투표
                        </button>
                    </div>

                    <!-- ==================== 학생 명단 탭 ==================== -->
                    <div id="panel-students" class="tab-panel">
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-5 text-white">
                                <div class="flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <h3 class="font-bold text-lg"><i class="fas fa-users mr-2"></i>학생 명단</h3>
                                        <p class="text-sm text-white/80" id="student-count">총 0명</p>
                                    </div>
                                    <div class="flex gap-2 flex-wrap">
                                        <button onclick="openAddStudentModal()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                            <i class="fas fa-user-plus mr-1"></i>학생 추가
                                        </button>
                                        <button onclick="openUploadModal()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                            <i class="fas fa-upload mr-1"></i>엑셀 업로드
                                        </button>
                                        <a href="/api/homeroom/students/template" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition inline-flex items-center">
                                            <i class="fas fa-file-download mr-1"></i>양식 다운로드
                                        </a>
                                        <button onclick="printStudentList()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition no-print">
                                            <i class="fas fa-print mr-1"></i>출력
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-50 border-b">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">번호</th>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">이름</th>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">생년월일</th>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">연락처</th>
                                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">학급자치</th>
                                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">상담</th>
                                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">기초자료</th>
                                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">관리</th>
                                        </tr>
                                    </thead>
                                    <tbody id="student-list">
                                        <tr><td colspan="8" class="text-center py-12 text-slate-400"><i class="fas fa-spinner fa-spin mr-2"></i>로딩 중...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== 학부모 명단 탭 ==================== -->
                    <div id="panel-parents" class="tab-panel hidden">
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-purple-500 to-violet-600 p-5 text-white">
                                <div class="flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <h3 class="font-bold text-lg"><i class="fas fa-user-friends mr-2"></i>학부모 명단</h3>
                                        <p class="text-sm text-white/80" id="parent-count">총 0명</p>
                                    </div>
                                    <div class="flex gap-2 flex-wrap">
                                        <button onclick="printParentList()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition no-print">
                                            <i class="fas fa-print mr-1"></i>출력
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-50 border-b">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">번호</th>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">학부모 이름</th>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">연락처</th>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">자녀 이름</th>
                                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-500">자녀 생년월일</th>
                                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-500">관리</th>
                                        </tr>
                                    </thead>
                                    <tbody id="parent-list">
                                        <tr><td colspan="6" class="text-center py-12 text-slate-400"><i class="fas fa-spinner fa-spin mr-2"></i>로딩 중...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 학급 공지 탭 -->
                    <div id="panel-notice" class="tab-panel hidden">
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-5 text-white flex justify-between items-center">
                                <h3 class="font-bold text-lg"><i class="fas fa-bullhorn mr-2"></i>학급 공지사항</h3>
                                <button onclick="openNoticeModal()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                    <i class="fas fa-plus mr-1"></i>공지 등록
                                </button>
                            </div>
                            <div id="notice-list" class="divide-y divide-slate-100 max-h-[500px] overflow-y-auto">
                                <div class="text-center py-12 text-slate-400">공지사항이 없습니다.</div>
                            </div>
                        </div>
                    </div>

                    <!-- 상담 일정 탭 -->
                    <div id="panel-schedule" class="tab-panel hidden">
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-5 text-white flex justify-between items-center">
                                <h3 class="font-bold text-lg"><i class="fas fa-calendar-check mr-2"></i>상담 일정</h3>
                                <button onclick="openScheduleModal()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                    <i class="fas fa-plus mr-1"></i>일정 등록
                                </button>
                            </div>
                            <div id="schedule-list" class="divide-y divide-slate-100 max-h-[500px] overflow-y-auto">
                                <div class="text-center py-12 text-slate-400">상담 일정이 없습니다.</div>
                            </div>
                        </div>
                    </div>

                    <!-- 상담 일지 탭 -->
                    <div id="panel-log" class="tab-panel hidden">
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-600 p-5 text-white flex justify-between items-center">
                                <h3 class="font-bold text-lg"><i class="fas fa-clipboard-list mr-2"></i>상담 일지</h3>
                                <button onclick="openLogModal()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                    <i class="fas fa-plus mr-1"></i>일지 작성
                                </button>
                            </div>
                            <div id="log-list" class="divide-y divide-slate-100 max-h-[500px] overflow-y-auto">
                                <div class="text-center py-12 text-slate-400">상담 일지가 없습니다.</div>
                            </div>
                        </div>
                    </div>

                    <!-- 생기부 기초자료 탭 -->
                    <div id="panel-record" class="tab-panel hidden">
                        <!-- 학년도/학기 선택 (공통) -->
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden mb-6">
                            <div class="bg-gradient-to-r from-teal-500 to-cyan-600 p-5 text-white">
                                <h3 class="font-bold text-lg"><i class="fas fa-database mr-2"></i>생기부 기초자료</h3>
                                <p class="text-sm text-white/80">학생별 기초 자료와 학급 공통사항을 관리합니다.</p>
                            </div>
                            <div class="p-6">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-2">학생 선택</label>
                                        <select id="record-student" onchange="loadStudentRecord()" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-teal-500 outline-none">
                                            <option value="">학생을 선택하세요</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-2">학년도</label>
                                        <select id="record-year" onchange="loadStudentRecord(); loadCommonActivities()" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-teal-500 outline-none"></select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-2">학기</label>
                                        <select id="record-semester" onchange="loadStudentRecord(); loadCommonActivities()" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-teal-500 outline-none">
                                            <option value="1">1학기</option>
                                            <option value="2">2학기</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 2열 그리드: 좌측 학생 기초자료 / 우측 학급 공통사항 -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- 좌측: 학생별 기초자료 -->
                            <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                                <div class="bg-gradient-to-r from-teal-500 to-cyan-600 p-4 text-white">
                                    <h3 class="font-bold"><i class="fas fa-user-edit mr-2"></i>학생별 기초자료</h3>
                                </div>
                                <div class="p-5">
                                    <div id="record-form" class="hidden space-y-4">
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-2">기초 자료 내용</label>
                                            <textarea id="record-content" rows="10" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-teal-500 outline-none resize-none" placeholder="학생의 특성, 활동 내역, 상담 내용, 관찰 기록 등 생기부 작성에 참고할 기초 자료를 자유롭게 입력하세요."></textarea>
                                        </div>
                                        <!-- 파일 업로드 영역 -->
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-2">
                                                <i class="fas fa-paperclip mr-1"></i>첨부 파일
                                                <span class="text-slate-400 font-normal ml-1">(PDF, HWP, DOCX, XLSX, JPG, PNG / 최대 10MB)</span>
                                            </label>
                                            <div class="border-2 border-dashed border-slate-200 rounded-xl p-4 hover:border-teal-400 transition" id="record-drop-zone">
                                                <input type="file" id="record-file-input" multiple accept=".pdf,.hwp,.hwpx,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.zip" class="hidden" onchange="handleRecordFiles(this)">
                                                <div class="text-center">
                                                    <i class="fas fa-cloud-upload-alt text-2xl text-slate-300 mb-2"></i>
                                                    <p class="text-sm text-slate-500">파일을 드래그하거나 <button type="button" onclick="document.getElementById('record-file-input').click()" class="text-teal-600 font-bold hover:underline">클릭하여 선택</button></p>
                                                </div>
                                            </div>
                                            <div id="record-upload-progress" class="hidden mt-2">
                                                <div class="flex items-center gap-2 text-sm text-teal-600">
                                                    <i class="fas fa-spinner fa-spin"></i><span>업로드 중...</span>
                                                </div>
                                            </div>
                                            <div id="record-file-list" class="mt-3 space-y-2"></div>
                                        </div>
                                        <button onclick="saveStudentRecord()" class="w-full bg-gradient-to-r from-teal-500 to-cyan-600 text-white font-black py-4 rounded-xl shadow-lg hover:shadow-xl transition">
                                            <i class="fas fa-save mr-2"></i>저장하기
                                        </button>
                                    </div>
                                    <div id="record-placeholder" class="text-center py-12 text-slate-400">
                                        <i class="fas fa-hand-pointer text-3xl mb-3"></i>
                                        <p>위에서 학생을 선택하면<br>기초자료를 입력할 수 있습니다.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 우측: 학급 공통사항 -->
                            <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                                <div class="bg-gradient-to-r from-emerald-500 to-green-600 p-4 text-white flex justify-between items-center">
                                    <h3 class="font-bold"><i class="fas fa-layer-group mr-2"></i>학급 공통사항</h3>
                                    <button onclick="openCommonModal()" class="px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-xs font-bold transition">
                                        <i class="fas fa-plus mr-1"></i>등록
                                    </button>
                                </div>
                                <div class="p-5">
                                    <div id="common-activity-list" class="space-y-3 max-h-[500px] overflow-y-auto">
                                        <div class="text-center py-8 text-slate-400">등록된 공통사항이 없습니다.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 생기부 작성 탭 -->
                    <div id="panel-maker" class="tab-panel hidden">
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-5 text-white">
                                <h3 class="font-bold text-lg"><i class="fas fa-file-signature mr-2"></i>생기부 작성</h3>
                                <p class="text-sm text-white/80">AI 기반 생활기록부 작성 도구를 활용합니다.</p>
                            </div>
                            <div class="p-8">
                                <div class="text-center">
                                    <div class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <i class="fas fa-magic text-4xl text-indigo-500"></i>
                                    </div>
                                    <h4 class="text-xl font-bold text-slate-800 mb-3">AI 생기부 작성 도구</h4>
                                    <p class="text-slate-500 mb-6 max-w-md mx-auto">
                                        기초자료와 상담일지를 바탕으로<br>
                                        생활기록부 문장을 자동으로 생성합니다.
                                    </p>
                                    <a href="school_record_maker.html" class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-black rounded-xl shadow-lg hover:shadow-xl transition hover:scale-105">
                                        <i class="fas fa-external-link-alt mr-2"></i>생기부 작성하기
                                    </a>
                                    <p class="mt-4 text-sm text-red-500 font-bold"><i class="fas fa-coins mr-1"></i>학생 1인당 300포인트가 차감됩니다. (Free 사용자는 무제한)</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== 출결 관리 탭 ==================== -->
                    <div id="panel-attendance" class="tab-panel hidden">
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-teal-500 to-cyan-600 p-5 text-white">
                                <div class="flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <h3 class="font-bold text-lg"><i class="fas fa-clipboard-check mr-2"></i>출결 관리</h3>
                                        <p class="text-sm text-white/80">날짜별 출결을 체크하고 관리합니다.</p>
                                    </div>
                                    <div class="flex gap-2 items-center flex-wrap">
                                        <input type="date" id="att-date" class="px-3 py-2 rounded-xl text-sm text-slate-800 border-0" onchange="loadAttendanceSheet()">
                                        <button onclick="markAllPresent()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                            <i class="fas fa-check-double mr-1"></i>전체출석
                                        </button>
                                        <button onclick="saveAttendance()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                            <i class="fas fa-save mr-1"></i>저장
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4">
                                <div id="att-sheet" class="space-y-2">
                                    <p class="text-center text-sm text-slate-400 py-8">날짜를 선택하면 출석부가 표시됩니다.</p>
                                </div>
                            </div>
                        </div>

                        <!-- 월간 출결 현황 -->
                        <div class="glass-card rounded-2xl shadow-lg overflow-hidden mt-4">
                            <div class="bg-gradient-to-r from-slate-600 to-slate-700 p-4 text-white flex items-center justify-between">
                                <h3 class="font-bold"><i class="fas fa-chart-bar mr-2"></i>월간 출결 현황</h3>
                                <input type="month" id="att-month" class="px-3 py-1 rounded-lg text-sm text-slate-800 border-0" onchange="loadMonthlyOverview()">
                            </div>
                            <div class="p-4">
                                <div id="att-monthly" class="grid grid-cols-7 gap-1 text-center text-xs">
                                </div>
                                <div id="att-stats-summary" class="mt-4"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== 학급 투표 탭 ==================== -->
                    <div id="panel-vote" class="tab-panel hidden">
                        <div id="vote-list-view">
                            <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                                <div class="bg-gradient-to-r from-violet-500 to-purple-600 p-5 text-white flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <h3 class="font-bold text-lg"><i class="fas fa-vote-yea mr-2"></i>학급 투표</h3>
                                        <p class="text-sm text-white/80">학급 투표를 만들고 결과를 확인합니다.</p>
                                    </div>
                                    <button onclick="openVoteCreateModal()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-bold transition">
                                        <i class="fas fa-plus mr-1"></i>투표 만들기
                                    </button>
                                </div>
                                <div id="vote-list" class="divide-y divide-slate-100">
                                    <div class="text-center py-12 text-slate-400"><i class="fas fa-vote-yea text-3xl mb-2 opacity-30"></i><p class="text-sm">투표가 없습니다.</p></div>
                                </div>
                            </div>
                        </div>
                        <div id="vote-detail-view" class="hidden">
                            <button onclick="backToVoteList()" class="mb-4 px-4 py-2 bg-white rounded-xl text-sm font-bold text-slate-600 border hover:bg-slate-50 transition">
                                <i class="fas fa-arrow-left mr-2"></i>목록으로
                            </button>
                            <div id="vote-detail-content"></div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <!-- ==================== 투표 생성/수정 모달 ==================== -->
    <div id="vote-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeVoteModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden max-h-[90vh] flex flex-col">
            <div class="bg-gradient-to-r from-violet-500 to-purple-600 p-5 text-white flex-shrink-0">
                <button onclick="closeVoteModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <h3 class="font-bold text-lg" id="vote-modal-title"><i class="fas fa-vote-yea mr-2"></i>투표 만들기</h3>
            </div>
            <div class="p-6 overflow-y-auto flex-1 space-y-4">
                <input type="hidden" id="vote-edit-id" value="">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2">투표 제목 *</label>
                    <input type="text" id="vote-title" placeholder="예: 체육대회 종목 선정" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-violet-500 outline-none">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2">설명</label>
                    <textarea id="vote-description" rows="2" placeholder="투표 설명 (선택)" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-violet-500 outline-none resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-2">투표 유형</label>
                        <select id="vote-type" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-violet-500 outline-none">
                            <option value="single">단일 선택</option>
                            <option value="multiple">복수 선택</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-2">투표 대상</label>
                        <select id="vote-target" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-violet-500 outline-none">
                            <option value="student">학생만</option>
                            <option value="parent">학부모만</option>
                            <option value="both">학생+학부모</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2">선택지 * <span class="text-slate-400 font-normal">(최소 2개)</span></label>
                    <div id="vote-options-list" class="space-y-2"></div>
                    <button onclick="addVoteOption()" class="mt-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-bold transition w-full">
                        <i class="fas fa-plus mr-1"></i>선택지 추가
                    </button>
                </div>
                <div class="flex gap-3">
                    <button onclick="submitVote(false)" id="vote-submit-btn" class="flex-1 bg-slate-500 text-white font-black py-4 rounded-xl hover:bg-slate-600 transition">
                        <i class="fas fa-save mr-1"></i>임시 저장
                    </button>
                    <button onclick="submitVote(true)" id="vote-start-btn" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-black py-4 rounded-xl hover:opacity-90 transition">
                        <i class="fas fa-play mr-1"></i>저장 후 바로 시작
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== 학생 추가 모달 ==================== -->
    <div id="add-student-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeAddStudentModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl relative z-10 overflow-hidden max-h-[90vh] flex flex-col">
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-5 text-white flex-shrink-0">
                <button onclick="closeAddStudentModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <h3 class="font-bold text-lg"><i class="fas fa-user-plus mr-2"></i>학생 추가</h3>
                <p class="text-sm text-white/80">기존 학생을 검색하거나 새로 등록합니다.</p>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <!-- 기존 학생 검색 -->
                <div class="mb-6">
                    <h4 class="font-bold text-slate-700 mb-3 flex items-center"><i class="fas fa-search mr-2 text-green-500"></i>기존 학생 검색</h4>
                    <div class="flex gap-2">
                        <input type="text" id="search-student-keyword" placeholder="이름을 입력하세요 (1글자 이상)" class="flex-1 px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-green-500 outline-none" oninput="debounceSearch()">
                    </div>
                    <div id="search-results" class="mt-3 max-h-48 overflow-y-auto hidden">
                        <!-- 검색 결과가 여기 표시 -->
                    </div>
                </div>

                <div class="border-t border-slate-200 my-6 relative">
                    <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-4 text-sm font-bold text-slate-400">또는 직접 입력</span>
                </div>

                <!-- 수동 입력 -->
                <div>
                    <h4 class="font-bold text-slate-700 mb-3 flex items-center"><i class="fas fa-pen mr-2 text-blue-500"></i>학생 직접 등록</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">이름 <span class="text-red-500">*</span></label>
                            <input type="text" id="add-name" placeholder="학생 이름" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">번호</label>
                            <input type="number" id="add-classnum" placeholder="반 번호" min="1" max="50" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">생년월일</label>
                            <input type="text" id="add-birth" placeholder="예: 2008-03-15" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">연락처</label>
                            <input type="text" id="add-tel" placeholder="예: 010-1234-5678" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-green-500 outline-none">
                        </div>
                    </div>
                    <button onclick="addStudentManual()" class="w-full mt-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-black py-4 rounded-xl shadow-lg hover:shadow-xl transition">
                        <i class="fas fa-user-plus mr-2"></i>학생 등록
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== 엑셀 업로드 모달 ==================== -->
    <div id="upload-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeUploadModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden">
            <div class="bg-gradient-to-r from-emerald-500 to-teal-600 p-5 text-white">
                <button onclick="closeUploadModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <h3 class="font-bold text-lg"><i class="fas fa-file-excel mr-2"></i>엑셀로 학생 일괄 등록</h3>
            </div>
            <div class="p-6">
                <div class="bg-slate-50 rounded-xl p-4 mb-4 text-sm text-slate-600">
                    <p class="font-bold text-slate-700 mb-2"><i class="fas fa-info-circle mr-1 text-blue-500"></i>안내</p>
                    <ul class="space-y-1 ml-4 list-disc">
                        <li><b>이름</b>은 필수이고, 나머지는 있는 항목만 입력하면 됩니다.</li>
                        <li>이미 등록된 학생은 <b>이름 + 전화번호 또는 생년월일</b>로 동일인을 판별합니다.</li>
                        <li>동일인이면 반 배정만 업데이트, 신규면 새로 등록됩니다.</li>
                        <li>양식은 <a href="/api/homeroom/students/template" class="text-blue-500 underline font-bold">엑셀 양식 다운로드</a>에서 받으세요.</li>
                    </ul>
                </div>
                <div class="border-2 border-dashed border-slate-300 rounded-xl p-8 text-center hover:border-green-400 transition" id="drop-zone">
                    <input type="file" id="upload-file" accept=".xlsx,.xls" class="hidden" onchange="handleFileSelect(this)">
                    <div id="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt text-4xl text-slate-300 mb-3"></i>
                        <p class="text-slate-500 mb-2">파일을 드래그하거나 클릭하여 선택</p>
                        <button onclick="document.getElementById('upload-file').click()" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-bold transition">
                            파일 선택
                        </button>
                    </div>
                    <div id="upload-selected" class="hidden">
                        <i class="fas fa-file-excel text-4xl text-green-500 mb-2"></i>
                        <p class="font-bold text-slate-700" id="upload-filename"></p>
                    </div>
                </div>
                <button onclick="uploadExcel()" id="upload-btn" class="w-full mt-4 bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-black py-4 rounded-xl shadow-lg hover:shadow-xl transition disabled:opacity-50" disabled>
                    <i class="fas fa-upload mr-2"></i>업로드 및 등록
                </button>
                <div id="upload-result" class="hidden mt-4 p-4 rounded-xl text-sm"></div>
            </div>
        </div>
    </div>

    <!-- ==================== 학급 공지 등록 모달 ==================== -->
    <div id="notice-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeNoticeModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden">
            <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-5 text-white">
                <button onclick="closeNoticeModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <h3 class="font-bold text-lg" id="notice-modal-title"><i class="fas fa-bullhorn mr-2"></i>학급 공지 등록</h3>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">제목</label>
                    <input type="text" id="notice-title" placeholder="공지 제목" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">내용</label>
                    <textarea id="notice-content" rows="5" placeholder="공지 내용" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 outline-none resize-none"></textarea>
                </div>
                <button onclick="submitNotice()" id="notice-submit-btn" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white font-black py-4 rounded-xl">등록하기</button>
            </div>
        </div>
    </div>

    <!-- ==================== 상담 일정 등록 모달 ==================== -->
    <div id="schedule-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeScheduleModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden">
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-5 text-white">
                <button onclick="closeScheduleModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <h3 class="font-bold text-lg"><i class="fas fa-calendar-check mr-2"></i>상담 일정 등록</h3>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">학생 선택</label>
                    <select id="schedule-student" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                        <option value="">학생을 선택하세요</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">상담 일시</label>
                    <input type="datetime-local" id="schedule-date" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">상담 유형</label>
                    <select id="schedule-type" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                        <option value="대면상담">대면상담</option>
                        <option value="전화상담">전화상담</option>
                        <option value="학부모상담">학부모상담</option>
                        <option value="진로상담">진로상담</option>
                        <option value="학습상담">학습상담</option>
                        <option value="생활상담">생활상담</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">메모</label>
                    <textarea id="schedule-memo" rows="3" placeholder="상담 관련 메모" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none resize-none"></textarea>
                </div>
                <button onclick="submitSchedule()" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-black py-4 rounded-xl">등록하기</button>
            </div>
        </div>
    </div>

    <!-- ==================== 상담 일지 등록 모달 ==================== -->
    <div id="log-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeLogModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden max-h-[90vh] flex flex-col">
            <div class="bg-gradient-to-r from-purple-500 to-pink-600 p-5 text-white flex-shrink-0">
                <button onclick="closeLogModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <h3 class="font-bold text-lg"><i class="fas fa-clipboard-list mr-2"></i>상담 일지 작성</h3>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">학생 선택</label>
                    <select id="log-student" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 outline-none">
                        <option value="">학생을 선택하세요</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">상담 일자</label>
                    <input type="date" id="log-date" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">상담 유형</label>
                    <select id="log-type" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 outline-none">
                        <option value="대면상담">대면상담</option>
                        <option value="전화상담">전화상담</option>
                        <option value="학부모상담">학부모상담</option>
                        <option value="진로상담">진로상담</option>
                        <option value="학습상담">학습상담</option>
                        <option value="생활상담">생활상담</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">상담 내용</label>
                    <textarea id="log-content" rows="4" placeholder="상담 내용을 상세히 기록하세요" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 outline-none resize-none"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">상담 결과</label>
                    <textarea id="log-result" rows="3" placeholder="상담 결과 및 조치사항" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 outline-none resize-none"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">향후 계획</label>
                    <textarea id="log-plan" rows="2" placeholder="추후 상담 계획" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 outline-none resize-none"></textarea>
                </div>
                <button onclick="submitLog()" class="w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white font-black py-4 rounded-xl">저장하기</button>
            </div>
        </div>
    </div>


    <!-- ==================== 공통사항 등록 모달 ==================== -->
    <div id="common-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeCommonModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden">
            <div class="bg-gradient-to-r from-emerald-500 to-green-600 p-5 text-white">
                <button onclick="closeCommonModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <h3 class="font-bold text-lg"><i class="fas fa-layer-group mr-2"></i>학급 공통사항 등록</h3>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">활동 유형</label>
                    <select id="common-type" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 outline-none">
                        <option value="수학여행">수학여행</option>
                        <option value="체험학습">체험학습</option>
                        <option value="봉사활동">봉사활동</option>
                        <option value="현장학습">현장학습</option>
                        <option value="진로체험">진로체험</option>
                        <option value="학교행사">학교행사</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">활동 날짜</label>
                    <input type="date" id="common-date" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">제목</label>
                    <input type="text" id="common-title" placeholder="예: 경주 수학여행" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">내용</label>
                    <textarea id="common-content" rows="4" placeholder="활동 내용을 상세히 기록하세요. 이 내용이 생기부 작성 시 참고됩니다." class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-emerald-500 outline-none resize-none"></textarea>
                </div>
                <button onclick="submitCommon()" class="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white font-black py-4 rounded-xl">등록하기</button>
            </div>
        </div>
    </div>
    <script src="homeroom-core.js?v=20260228"></script>
    <script src="homeroom-students.js?v=20260228"></script>
    <script src="homeroom-counsel.js?v=20260228"></script>
    <script src="homeroom-timetable.js?v=20260228"></script>
    <script src="homeroom-vote.js?v=20260228"></script>
<!-- 출력 영역 (화면에 안 보임, 인쇄 시만 표시) -->
<div id="print-area" style="display:none;"></div>

<script src="/static/js/help-modal.js" data-doc="homeroom"></script>
</body>
</html>