# .cell 파일 주간시간표 임포트 가이드

## 파일 형식
- `.cell` = 한셀(Hancel) 형식, 내부는 xlsx 호환 ZIP (XML sheets)
- openpyxl 직접 로드 시 스타일 오류 → `zipfile + ElementTree`로 XML 직접 파싱 필요
- 작업 시 `.xlsx`로 복사 후 처리

## 셀 값 파싱 규칙

### 일반수업 (밑줄 없음)
- 형식: `{학년1자리}{반2자리}{과목명}` 예: `107국어` = 1학년 7반 국어
- 정규식: `^(\d)(\d{2})(.+)$`

### 이동수업/밴드 (밑줄 있음)
- 형식: `{교실3자리}{밴드영문자}_{과목명}` 예: `306A_화작` = 밴드A, 과목 화작
- 정규식: `^(\d+)([A-Z])_(.+)$`
- 밴드 영문자 = 시간대 그룹 (같은 영문자 = 같은 시간에 동시 수업)

## 컬럼 매핑 (초지고등학교 기준)
- 월(C~H): 1~6교시, 화(I~O): 1~7교시, 수(P~T): 1~5교시
- 목(U~AA): 1~7교시, 금(AB~AF): 1~5교시
- Row 2: 요일 헤더, Row 3: 교시 번호, Row 4~: 교사 데이터

## 밴드 학년 판별 로직
- 밴드는 2학년/3학년 공통 사용 가능 (1학년은 일반수업만)
- 판별법: 밴드 시간대에 해당 학년의 빈 반(일반수업 없음)이 있으면 → 그 학년이 밴드 참여
- timetable_band_slots에 grade별 별도 INSERT

## DB INSERT 순서
1. `timetable` - 일반수업 (grade, class_no, subject, teacher 직접 매핑)
2. `timetable_band_slots` - 밴드→시간대 매핑 (grade별)
3. `timetable` - 밴드 교시에 "이동수업" 플레이스홀더 (빈 반에 대해)

## 임포트 결과 (초지고등학교, 2026-02-28)
- school_id: 5794
- timetable: 870건 (일반 566 + 이동수업 304)
- timetable_band_slots: 90건 (밴드 A~J × 2학년/3학년)
- 1학년 10반(각 30교시), 2학년 9반(각 30교시), 3학년 10반(각 30교시)

## 과목 약칭 → 정식명 매핑 (초지고등학교)
| .cell 약칭 | 정식 과목명 | 학년 | 비고 |
|-----------|-----------|------|------|
| 생Ⅰ | 생명과학Ⅰ | 2학년 | 밴드(이동수업) |
| 생Ⅱ | 생명과학Ⅱ | 3학년 | 밴드(이동수업) |
| 생과 | 생활과 과학 | 2·3학년 | 일반+밴드 |
| 화Ⅱ | 화학Ⅱ | 3학년 | 밴드 |
| 생한 | 생활한문 | - | 밴드 |
| 생윤 | 생활과 윤리 | 3학년 | 일반+밴드 |
※ timetable_stu_group 등록 시 정식 과목명 사용

## 스크립트 위치
- `/tmp/import_choji_timetable.py` (일회성, 재사용 시 school_id/파일 경로 변경)
