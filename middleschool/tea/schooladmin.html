<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SchoolUs - í•™êµ í–‰ì • ëŒ€ì‹œë³´ë“œ</title>
    <script src="/static/js/tailwindcss.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .sidebar-gradient { background: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #334155 100%); }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .dashboard-card { transition: all 0.2s; }
        .dashboard-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .meal-input { min-height: 60px; }

        #mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 40; }
        #mobile-overlay.active { display: block; }
        #sidebar.mobile-open { display: flex !important; position: fixed !important; left: 0 !important; top: 0 !important; bottom: 0 !important; z-index: 50 !important; flex-direction: column !important; }

        /* ëª¨ë°”ì¼ í° ê¸€ì”¨ ëŒ€ì‘: í„°ì¹˜ ì˜ì—­ í™•ëŒ€ + ì‚¬ì´ë“œë°” ì „ì²´ ìŠ¤í¬ë¡¤ */
        @media (max-width: 767px) {
            #sidebar.mobile-open { overflow-y: auto !important; }
            #sidebar.mobile-open .nav-wrap { flex: none !important; min-height: auto !important; }
            #sidebar.mobile-open #sidebar-nav { height: auto !important; overflow: visible !important; }
            .nav-item { min-height: 52px; padding-top: 14px !important; padding-bottom: 14px !important; font-size: 15px !important; }
            #sidebar .space-y-1 > li { margin-bottom: 4px; }
            #sidebar .p-4.border-t a { min-height: 48px; padding-top: 14px !important; padding-bottom: 14px !important; font-size: 14px !important; }
            .tab-btn { min-height: 48px; padding: 12px 16px !important; font-size: 14px !important; white-space: nowrap; }
        }
    </style>
    <!-- Google Analytics (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LJ1TCE277"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7LJ1TCE277');
    </script>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SchoolUs">
    <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">
    <script src="/static/js/pwa-install.js" defer></script>
    <script src="/static/js/pwa-push.js" defer></script>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex overflow-hidden">

    <div id="mobile-overlay"></div>
    <aside id="sidebar" class="w-72 sidebar-gradient text-slate-300 flex-col flex-shrink-0 hidden md:flex shadow-2xl">
        <div class="p-6 border-b border-slate-700/50">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
                    <i class="fas fa-school text-xl"></i>
                </div>
                <div>
                    <span class="font-black text-2xl text-white tracking-tight">SchoolUs</span>
                    <p class="text-xs text-slate-400 font-medium">ìŠ¤ë§ˆíŠ¸ êµìœ¡ í”Œë«í¼</p>
                </div>
            </div>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li><a href="../tea.html" class="flex items-center px-6 py-3 hover:bg-slate-800 transition"><i class="fas fa-desktop w-6 mr-3"></i> ë‚˜ì˜ ëŒ€ì‹œë³´ë“œ</a></li>
                <li class="px-6 pt-6 pb-2 text-xs font-bold uppercase text-slate-500">ADMINISTRATIVE TASKS</li>
                
                <li><a href="#" onclick="openNoticeModal(); return false;" class="flex items-center px-6 py-3 hover:bg-slate-800 transition"><i class="fas fa-bullhorn w-6 mr-3"></i> ê³µì§€ì‚¬í•­ ë“±ë¡</a></li>
                
                <li><a href="#" onclick="openMealModal(); return false;" class="flex items-center px-6 py-3 hover:bg-slate-800 transition"><i class="fas fa-utensils w-6 mr-3"></i> ì›”ê°„ ê¸‰ì‹ ë“±ë¡</a></li>
                
                <li><a href="timetablechange.html" class="flex items-center px-6 py-3 hover:bg-slate-800 transition"><i class="fas fa-calendar-alt w-6 mr-3"></i> ì‹œê°„í‘œ ì¡°íšŒ/ë³€ê²½</a></li>

                <li><a href="classtime_maker_base.html" class="flex items-center px-6 py-3 hover:bg-slate-800 transition"><i class="fas fa-database w-6 mr-3"></i> ê¸°ì´ˆë°ì´í„° ê´€ë¦¬</a></li>
                
                <li><a href="timetablemaker.html" class="flex items-center px-6 py-3 hover:bg-slate-800 transition"><i class="fas fa-edit w-6 mr-3"></i> ì‹œê°„í‘œ ì‘ì„±</a></li>
                
                <li><a href="class_maker.html" class="flex items-center px-6 py-3 hover:bg-slate-800 transition"><i class="fas fa-layer-group w-6 mr-3"></i> ë°˜í¸ì„±</a></li>
            </ul>
        </nav>
        <div class="p-4 border-t border-slate-700">
            <a href="../tea.html" class="flex items-center justify-center w-full py-2 bg-slate-800 hover:bg-slate-700 rounded text-sm transition"><i class="fas fa-arrow-left mr-2"></i> ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white h-16 border-b flex items-center justify-between px-8 shadow-sm">
            <div class="flex items-center gap-4">
                <button id="sidebar-toggle" onclick="toggleMobileSidebar()" class="md:hidden text-slate-600"><i class="fas fa-bars text-xl"></i></button>
                <h2 class="text-xl font-bold text-slate-800">í–‰ì • ì—…ë¬´ ëŒ€ì‹œë³´ë“œ</h2>
                <span id="userSchoolBadge" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold"></span>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center gap-2 bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 px-3 py-1.5 rounded-full">
                    <i class="fas fa-coins text-amber-500"></i>
                    <span id="userPoint" class="font-bold text-amber-700 text-sm">0</span>
                    <span class="text-amber-600 text-xs">P</span>
                </div>
                <div class="flex items-center gap-2">
                    <div id="userAvatar" class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-xs">T</div>
                    <span id="userName" class="text-sm font-medium text-slate-700 hidden md:block"></span>
                </div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-8">
            <div class="max-w-6xl mx-auto fade-in">
                
                <div class="mb-8">
                    <h3 id="welcomeMessage" class="text-2xl font-bold text-slate-800 mb-2">ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</h3>
                    <p class="text-slate-500">ì˜¤ëŠ˜ ì²˜ë¦¬í•´ì•¼ í•  ì£¼ìš” í–‰ì • ì—…ë¬´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    
                    <a href="#" onclick="openNoticeModal(); return false;" class="block group">
                        <div class="bg-white h-full p-6 rounded-xl border border-slate-200 shadow-sm dashboard-card group-hover:border-yellow-300">
                            <div class="w-12 h-12 rounded-lg bg-yellow-100 text-yellow-600 flex items-center justify-center mb-4 text-xl">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <h4 class="text-lg font-bold text-slate-800 mb-2">ê³µì§€ì‚¬í•­ ë“±ë¡í•˜ê¸°</h4>
                            <p class="text-sm text-slate-500">í•™êµ ì „ì²´ ê³µì§€ì‚¬í•­ ë° ê°€ì •í†µì‹ ë¬¸ì„ ë“±ë¡í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                        </div>
                    </a>

                    <a href="#" onclick="openMealModal(); return false;" class="block group">
                        <div class="bg-white h-full p-6 rounded-xl border border-slate-200 shadow-sm dashboard-card group-hover:border-pink-300">
                            <div class="w-12 h-12 rounded-lg bg-pink-100 text-pink-600 flex items-center justify-center mb-4 text-xl">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <h4 class="text-lg font-bold text-slate-800 mb-2">ì›”ê°„ ê¸‰ì‹ ë“±ë¡í•˜ê¸°</h4>
                            <p class="text-sm text-slate-500">ì›”ë³„ ê¸‰ì‹ ì‹ë‹¨í‘œ ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                        </div>
                    </a>

                    <a href="timetablechange.html" class="block group">
                        <div class="bg-white h-full p-6 rounded-xl border border-slate-200 shadow-sm dashboard-card group-hover:border-blue-300">
                            <div class="w-12 h-12 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center mb-4 text-xl">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <h4 class="text-lg font-bold text-slate-800 mb-2">ì‹œê°„í‘œ ì¡°íšŒ ë° ë³€ê²½</h4>
                            <p class="text-sm text-slate-500">ì „ì²´ í•™ê¸‰ì˜ ì‹œê°„í‘œë¥¼ ì¡°íšŒí•˜ê³  ì„ì‹œ ì‹œê°„í‘œë¥¼ ë°°ì •í•©ë‹ˆë‹¤.</p>
                        </div>
                    </a>

                    <a href="classtime_maker_base.html" class="block group">
                        <div class="bg-white h-full p-6 rounded-xl border border-slate-200 shadow-sm dashboard-card group-hover:border-green-300">
                            <div class="w-12 h-12 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center mb-4 text-xl">
                                <i class="fas fa-database"></i>
                            </div>
                            <h4 class="text-lg font-bold text-slate-800 mb-2">ë°˜í¸ì„±/ì‹œê°„í‘œ ê¸°ì´ˆë°ì´í„°</h4>
                            <p class="text-sm text-slate-500">ë°˜í¸ì„± ë° ì‹œê°„í‘œ ì‘ì„±ì— í•„ìš”í•œ ê¸°ì´ˆ ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                        </div>
                    </a>

                    <a href="timetablemaker.html" class="block group">
                        <div class="bg-white h-full p-6 rounded-xl border border-slate-200 shadow-sm dashboard-card group-hover:border-indigo-300">
                            <div class="w-12 h-12 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center mb-4 text-xl">
                                <i class="fas fa-edit"></i>
                            </div>
                            <h4 class="text-lg font-bold text-slate-800 mb-2">ì‹œê°„í‘œ ì‘ì„±</h4>
                            <p class="text-sm text-slate-500">ê¸°ì´ˆ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•™êµ ì „ì²´ ì‹œê°„í‘œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</p>
                        </div>
                    </a>

                    <a href="class_maker.html" class="block group">
                        <div class="bg-white h-full p-6 rounded-xl border border-slate-200 shadow-sm dashboard-card group-hover:border-purple-300">
                            <div class="w-12 h-12 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center mb-4 text-xl">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <h4 class="text-lg font-bold text-slate-800 mb-2">ë°˜í¸ì„±</h4>
                            <p class="text-sm text-slate-500">í•™ìƒ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•™ê¸‰ì„ í¸ì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                        </div>
                    </a>

                </div>

            </div>
        </div>
    </main>

    <!-- ê³µì§€ì‚¬í•­ ë“±ë¡ ëª¨ë‹¬ -->
    <div id="notice-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeNoticeModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl relative z-10 overflow-hidden">
            <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-6 text-white">
                <button onclick="closeNoticeModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center"><i class="fas fa-bullhorn text-2xl"></i></div>
                    <div><h2 class="text-xl font-black">ê³µì§€ì‚¬í•­ ë“±ë¡</h2><p class="text-sm text-white/80">ìƒˆ ê³µì§€ì‚¬í•­ì„ ì‘ì„±í•˜ì„¸ìš”</p></div>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">ì œëª©</label>
                    <input type="text" id="notice-title" placeholder="ê³µì§€ì‚¬í•­ ì œëª©" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 outline-none font-medium">
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">ë‚´ìš©</label>
                    <textarea id="notice-message" rows="6" placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 outline-none font-medium resize-none"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold text-slate-500 mb-2">ìˆ˜ì •/ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬ ì´ìƒ)</label>
                    <input type="password" id="notice-correct-no" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" maxlength="20" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 outline-none font-medium">
                </div>
                <p class="text-xs text-slate-400 mb-4"><i class="fas fa-info-circle mr-1"></i>ê³µì§€ì‚¬í•­ì€ í•™êµ ì „ì²´(êµì‚¬, í•™ìƒ, í•™ë¶€ëª¨)ì—ê²Œ ê³µê°œë©ë‹ˆë‹¤.</p>
                <button onclick="submitNotice()" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white font-black py-4 rounded-xl shadow-lg hover:shadow-xl transition">ë“±ë¡í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì›”ê°„ ê¸‰ì‹ ë“±ë¡ ëª¨ë‹¬ -->
    <div id="meal-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeMealModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] relative z-10 overflow-hidden flex flex-col">
            <div class="bg-gradient-to-r from-pink-500 to-rose-600 p-6 text-white flex-shrink-0">
                <button onclick="closeMealModal()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center"><i class="fas fa-utensils text-2xl"></i></div>
                    <div><h2 class="text-xl font-black">ì›”ê°„ ê¸‰ì‹ ë“±ë¡</h2><p class="text-sm text-white/80">í•œ ë‹¬ ê¸‰ì‹ ë©”ë‰´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p></div>
                </div>
            </div>
            
            <!-- ë…„ì›” ì„ íƒ -->
            <div class="p-4 bg-slate-50 border-b flex items-center gap-4 flex-shrink-0">
                <div class="flex items-center gap-2">
                    <label class="text-sm font-bold text-slate-600">ë…„ë„</label>
                    <select id="meal-year" onchange="loadMealData()" class="px-4 py-2 border-2 border-slate-200 rounded-xl focus:border-pink-500 outline-none font-medium">
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-sm font-bold text-slate-600">ì›”</label>
                    <select id="meal-month" onchange="loadMealData()" class="px-4 py-2 border-2 border-slate-200 rounded-xl focus:border-pink-500 outline-none font-medium">
                        <option value="1">1ì›”</option>
                        <option value="2">2ì›”</option>
                        <option value="3">3ì›”</option>
                        <option value="4">4ì›”</option>
                        <option value="5">5ì›”</option>
                        <option value="6">6ì›”</option>
                        <option value="7">7ì›”</option>
                        <option value="8">8ì›”</option>
                        <option value="9">9ì›”</option>
                        <option value="10">10ì›”</option>
                        <option value="11">11ì›”</option>
                        <option value="12">12ì›”</option>
                    </select>
                </div>
                <button onclick="loadMealData()" class="px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded-xl text-sm font-bold transition">
                    <i class="fas fa-sync-alt mr-1"></i>ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <span id="meal-status" class="text-sm text-slate-500"></span>
            </div>
            
            <!-- ê¸‰ì‹ ì…ë ¥ ê·¸ë¦¬ë“œ -->
            <div class="flex-1 overflow-y-auto p-6">
                <div id="meal-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- JSë¡œ ìƒì„± -->
                </div>
            </div>
            
            <!-- ì €ì¥ ë²„íŠ¼ -->
            <div class="p-4 bg-slate-50 border-t flex-shrink-0">
                <button onclick="saveMealData()" class="w-full bg-gradient-to-r from-pink-500 to-rose-600 text-white font-black py-4 rounded-xl shadow-lg hover:shadow-xl transition">
                    <i class="fas fa-save mr-2"></i>ì €ì¥í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', () => {
            initUserInfo();
        });

        function initUserInfo() {
            const userStr = localStorage.getItem('schoolus_user');
            if (!userStr) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/';
                return;
            }
            
            currentUser = JSON.parse(userStr);
            
            const schoolBadge = document.getElementById('userSchoolBadge');
            if (currentUser.member_school) {
                schoolBadge.textContent = currentUser.member_school;
            } else {
                schoolBadge.textContent = 'í•™êµ ë¯¸ì„¤ì •';
                schoolBadge.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold';
            }
            
            const userName = document.getElementById('userName');
            const userAvatar = document.getElementById('userAvatar');
            const welcomeMessage = document.getElementById('welcomeMessage');
            
            if (currentUser.member_name) {
                if (userName) userName.textContent = currentUser.member_name + ' ì„ ìƒë‹˜';
                if (userAvatar) userAvatar.textContent = currentUser.member_name.charAt(0);
                if (welcomeMessage) welcomeMessage.textContent = `${currentUser.member_name} ì„ ìƒë‹˜, ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹`;
            }
            
            loadUserPoint();
        }
        
        async function loadUserPoint() {
            try {
                const url = `/api/teacher/info?member_id=${encodeURIComponent(currentUser.member_id)}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success && data.teacher) {
                    displayPoint(data.teacher.point);
                }
            } catch (error) {
                console.error('í¬ì¸íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        function displayPoint(point) {
            const el = document.getElementById('userPoint');
            if (!el) return;
            
            if (point === 'free' || point === 'Free') {
                el.textContent = 'Free';
            } else if (point === null || point === undefined || point === '') {
                el.textContent = '0';
            } else {
                const num = parseInt(point);
                el.textContent = isNaN(num) ? '0' : num.toLocaleString();
            }
        }

        function getSchoolParams() {
            const params = new URLSearchParams();
            if (currentUser.school_id) params.append('school_id', currentUser.school_id);
            if (currentUser.member_school) params.append('member_school', currentUser.member_school);
            return params;
        }

        // ==========================================
        // ê³µì§€ì‚¬í•­ ëª¨ë‹¬
        // ==========================================
        function openNoticeModal() {
            document.getElementById('notice-title').value = '';
            document.getElementById('notice-message').value = '';
            document.getElementById('notice-correct-no').value = '';
            document.getElementById('notice-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeNoticeModal() {
            document.getElementById('notice-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        async function submitNotice() {
            const title = document.getElementById('notice-title').value.trim();
            const message = document.getElementById('notice-message').value.trim();
            const correct_no = document.getElementById('notice-correct-no').value.trim();
            
            if (!title || !message) return alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            if (!correct_no || correct_no.length < 4) return alert('ìˆ˜ì •/ì‚­ì œìš© ë¹„ë°€ë²ˆí˜¸ë¥¼ 4ìë¦¬ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            
            try {
                const response = await fetch('/api/notice/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        member_name: currentUser.member_name,
                        member_school: currentUser.member_school,
                        school_id: currentUser.school_id,
                        title, message, correct_no
                    })
                });
                const data = await response.json();
                if (data.success) {
                    alert(data.message);
                    closeNoticeModal();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('ê³µì§€ì‚¬í•­ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ==========================================
        // ì›”ê°„ ê¸‰ì‹ ëª¨ë‹¬
        // ==========================================
        function openMealModal() {
            // ë…„ë„ ì˜µì…˜ ìƒì„±
            const yearSelect = document.getElementById('meal-year');
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            for (let y = currentYear - 1; y <= currentYear + 1; y++) {
                const option = document.createElement('option');
                option.value = y;
                option.textContent = y + 'ë…„';
                if (y === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
            
            // í˜„ì¬ ì›” ì„ íƒ
            document.getElementById('meal-month').value = new Date().getMonth() + 1;
            
            // ê·¸ë¦¬ë“œ ìƒì„± ë° ë°ì´í„° ë¡œë“œ
            generateMealGrid();
            loadMealData();
            
            document.getElementById('meal-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeMealModal() {
            document.getElementById('meal-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function generateMealGrid() {
            const year = parseInt(document.getElementById('meal-year').value);
            const month = parseInt(document.getElementById('meal-month').value);
            const daysInMonth = new Date(year, month, 0).getDate();
            
            const grid = document.getElementById('meal-grid');
            grid.innerHTML = '';
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                
                const card = document.createElement('div');
                card.className = `p-3 rounded-xl border-2 ${isWeekend ? 'border-slate-100 bg-slate-50' : 'border-slate-200 bg-white'}`;
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-slate-800">${day}ì¼</span>
                        <span class="text-xs px-2 py-0.5 rounded-full ${date.getDay() === 0 ? 'bg-red-100 text-red-600' : date.getDay() === 6 ? 'bg-blue-100 text-blue-600' : 'bg-slate-100 text-slate-600'}">${dayOfWeek}</span>
                    </div>
                    <textarea id="meal-day-${day}" rows="3" placeholder="${isWeekend ? 'ì£¼ë§' : 'ë©”ë‰´ ì…ë ¥'}" 
                        class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:border-pink-400 outline-none resize-none meal-input ${isWeekend ? 'bg-slate-100' : ''}"></textarea>
                `;
                grid.appendChild(card);
            }
        }

        async function loadMealData() {
            const year = document.getElementById('meal-year').value;
            const month = document.getElementById('meal-month').value;
            const status = document.getElementById('meal-status');
            
            // ê·¸ë¦¬ë“œ ì¬ìƒì„±
            generateMealGrid();
            
            status.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            
            try {
                const params = getSchoolParams();
                params.append('year', year);
                params.append('month', month);
                
                const response = await fetch(`/api/meal/month?${params.toString()}`);
                const data = await response.json();
                
                if (data.success && data.meals) {
                    const mealCount = Object.keys(data.meals).length;
                    
                    // ê° ë‚ ì§œì— ë°ì´í„° ì±„ìš°ê¸°
                    for (const [day, mealInfo] of Object.entries(data.meals)) {
                        const textarea = document.getElementById(`meal-day-${day}`);
                        if (textarea) {
                            textarea.value = mealInfo.menu || '';
                        }
                    }
                    
                    status.innerHTML = mealCount > 0 
                        ? `<i class="fas fa-check-circle text-green-500 mr-1"></i>${mealCount}ì¼ë¶„ ë°ì´í„° ë¡œë“œë¨`
                        : `<i class="fas fa-info-circle text-slate-400 mr-1"></i>ì €ì¥ëœ ë°ì´í„° ì—†ìŒ`;
                } else {
                    status.innerHTML = `<i class="fas fa-info-circle text-slate-400 mr-1"></i>ì €ì¥ëœ ë°ì´í„° ì—†ìŒ`;
                }
            } catch (error) {
                status.innerHTML = `<i class="fas fa-exclamation-circle text-red-500 mr-1"></i>ë¡œë“œ ì‹¤íŒ¨`;
                console.error('ê¸‰ì‹ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        async function saveMealData() {
            const year = document.getElementById('meal-year').value;
            const month = document.getElementById('meal-month').value;
            const daysInMonth = new Date(parseInt(year), parseInt(month), 0).getDate();
            
            // ëª¨ë“  ë‚ ì§œì˜ ë©”ë‰´ ìˆ˜ì§‘
            const meals = {};
            let filledCount = 0;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const textarea = document.getElementById(`meal-day-${day}`);
                if (textarea && textarea.value.trim()) {
                    meals[day] = textarea.value.trim();
                    filledCount++;
                }
            }
            
            if (filledCount === 0) {
                if (!confirm('ì…ë ¥ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }
            
            try {
                const response = await fetch('/api/meal/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        school_id: currentUser.school_id,
                        member_school: currentUser.member_school,
                        year, month, meals
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    document.getElementById('meal-status').innerHTML = `<i class="fas fa-check-circle text-green-500 mr-1"></i>ì €ì¥ ì™„ë£Œ`;
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('ê¸‰ì‹ ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        function toggleMobileSidebar() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
            document.getElementById('mobile-overlay').classList.toggle('active');
        }
        document.getElementById('mobile-overlay').onclick = function() {
            document.getElementById('sidebar').classList.remove('mobile-open');
            this.classList.remove('active');
        };
    </script>
</body>
</html>